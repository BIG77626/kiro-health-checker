<!-- pages/vocab-book/vocab-book.wxml - ç”Ÿè¯æœ¬é¡µé¢ -->

<view class="vocab-book-page {{themeClass}}">

  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-back" bindtap="onBack">
      <text class="back-icon">â†</text>
    </view>
    <view class="nav-title">
      <text>ç”Ÿè¯æœ¬</text>
    </view>
    <view class="nav-actions">
      <view class="nav-action" bindtap="toggleSearch">
        <text class="action-icon">ğŸ”</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-section" wx:if="{{pageState === 'loaded'}}">
    <view class="stats-grid">
      <view class="stat-card">
        <text class="stat-value">{{vocabBook.stats.totalWords}}</text>
        <text class="stat-label">æ€»å•è¯</text>
      </view>
      <view class="stat-card">
        <text class="stat-value">{{vocabBook.stats.reviewedToday}}</text>
        <text class="stat-label">ä»Šæ—¥å¤ä¹ </text>
      </view>
      <view class="stat-card">
        <text class="stat-value">{{vocabBook.stats.masteredWords}}</text>
        <text class="stat-label">å·²æŒæ¡</text>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åºæ  -->
  <view class="filter-bar" wx:if="{{pageState === 'loaded'}}">
    <scroll-view class="filter-scroll" scroll-x="true">
      <view class="filter-tabs">
        <view
          class="filter-tab {{filterType === 'all' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-type="all"
        >
          <text>å…¨éƒ¨</text>
        </view>
        <view
          class="filter-tab {{filterType === 'thisWeek' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-type="thisWeek"
        >
          <text>æœ¬å‘¨</text>
        </view>
        <view
          class="filter-tab {{filterType === 'thisMonth' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-type="thisMonth"
        >
          <text>æœ¬æœˆ</text>
        </view>
      </view>
    </scroll-view>

    <view class="sort-selector">
      <picker
        mode="selector"
        range="{{['æ—¶é—´', 'é¢‘ç‡', 'æŒæ¡åº¦']}}"
        value="{{sortType === 'time' ? 0 : sortType === 'frequency' ? 1 : 2}}"
        bindchange="onSortChange"
      >
        <view class="sort-text">
          <text>{{sortType === 'time' ? 'æ—¶é—´' : sortType === 'frequency' ? 'é¢‘ç‡' : 'æŒæ¡åº¦'}}</text>
          <text class="sort-icon">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-bar" wx:if="{{showSearch}}">
    <input
      class="search-input"
      placeholder="æœç´¢å•è¯æˆ–é‡Šä¹‰"
      value="{{searchKeyword}}"
      bindinput="onSearchInput"
      confirm-type="search"
    />
  </view>

  <!-- å•è¯åˆ—è¡¨ -->
  <view class="words-list" wx:if="{{pageState === 'loaded'}}">
    <view
      class="word-item"
      wx:for="{{getCurrentPageWords()}}"
      wx:key="wordId"
    >
      <view class="word-header">
        <view class="word-main">
          <text class="word-text">{{item.word}}</text>
          <text class="word-phonetic" wx:if="{{item.phonetic}}">{{item.phonetic}}</text>
        </view>
        <view class="word-status">
          <text class="status-text {{item.reviewStatus}}">{{item.reviewStatusText}}</text>
        </view>
      </view>

      <view class="word-content">
        <text class="word-meaning">{{item.meaning}}</text>
        <view class="word-meta">
          <text class="meta-item">é‡åˆ°{{item.attempts || 1}}æ¬¡</text>
          <text class="meta-item">{{item.displayDate}}æ·»åŠ </text>
        </view>
      </view>

      <view class="word-progress" wx:if="{{item.reviewCount > 0}}">
        <view class="progress-bar">
          <view
            class="progress-fill"
            style="width: {{item.masteryRate}}%"
          ></view>
        </view>
        <text class="progress-text">{{item.reviewCount}}æ¬¡å¤ä¹ </text>
      </view>

      <view class="word-actions">
        <button
          class="action-btn review-btn"
          bindtap="onStartReview"
          data-word-id="{{item.wordId}}"
          wx:if="{{!item.mastered}}"
        >
          å¤ä¹ 
        </button>
        <button
          class="action-btn mastered-btn"
          bindtap="onMarkMastered"
          data-word-id="{{item.wordId}}"
          wx:if="{{!item.mastered}}"
        >
          å·²æŒæ¡
        </button>
        <button
          class="action-btn remove-btn"
          bindtap="onRemoveWord"
          data-word-id="{{item.wordId}}"
        >
          ç§»é™¤
        </button>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore}}" bindtap="loadMore">
      <text>åŠ è½½æ›´å¤š</text>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{pageState === 'empty'}}">
    <view class="empty-icon">ğŸ“–</view>
    <text class="empty-title">ç”Ÿè¯æœ¬æ˜¯ç©ºçš„</text>
    <text class="empty-desc">åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°éš¾è¯æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æç¤ºæ‚¨åŠ å…¥ç”Ÿè¯æœ¬</text>
    <button class="empty-btn" bindtap="onBack">è¿”å›å­¦ä¹ </button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{pageState === 'loading'}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{pageState === 'error'}}">
    <view class="error-icon">âš ï¸</view>
    <text class="error-title">åŠ è½½å¤±è´¥</text>
    <button class="error-btn" bindtap="initializePage">é‡è¯•</button>
  </view>

  <!-- å¤ä¹ æ¨¡æ€æ¡† -->
  <view class="review-modal" wx:if="{{showReviewModal}}" catchtap="onCloseReviewModal">
    <view class="modal-overlay" catchtap="onCloseReviewModal"></view>
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">å¤ä¹ å•è¯</text>
        <view class="modal-close" bindtap="onCloseReviewModal">
          <text>âœ•</text>
        </view>
      </view>

      <view class="review-word">
        <text class="review-word-text">{{reviewWord.word}}</text>
        <text class="review-word-phonetic" wx:if="{{reviewWord.phonetic}}">{{reviewWord.phonetic}}</text>
        <text class="review-word-meaning">{{reviewWord.meaning}}</text>
      </view>

      <view class="review-options">
        <view
          class="review-option"
          wx:for="{{reviewOptions}}"
          wx:key="value"
          bindtap="onSubmitReview"
          data-performance="{{item.value}}"
        >
          <view class="option-indicator" style="background-color: {{item.color}}"></view>
          <text class="option-text">{{item.text}}</text>
        </view>
      </view>
    </view>
  </view>

</view>
