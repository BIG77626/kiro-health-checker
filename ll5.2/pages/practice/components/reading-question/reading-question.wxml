<!--components/reading-question/reading-question.wxml-->
<view class="reading-question">
  
  <!-- æ–‡ç« æ ‡é¢˜ -->
  <view class="passage-header">
    <text class="passage-title">{{passage.title}}</text>
    <text class="passage-meta">Passage {{passageIndex + 1}} / {{totalPassages}}</text>
  </view>

  <!-- æ–‡ç« å†…å®¹ -->
  <scroll-view scroll-y class="passage-content" scroll-into-view="{{scrollTarget}}">
    <view 
      wx:for="{{passage.paragraphs}}" 
      wx:key="index"
      class="paragraph {{highlightedPara === index ? 'para-highlighted' : ''}}"
      id="para-{{index}}"
      data-index="{{index}}"
    >
      <text class="para-number">Â¶{{index + 1}}</text>
      <text class="para-text selectable" user-select="{{true}}" bindlongpress="onTextLongPress" data-text="{{item}}">{{item}}</text>
    </view>
  </scroll-view>

  <!-- é¢˜ç›®åˆ—è¡¨ -->
  <view class="questions-section">
    <text class="section-title">ç›¸å…³é¢˜ç›®</text>
    
    <view 
      wx:for="{{questions}}" 
      wx:key="id"
      class="question-item {{currentQuestionIndex === index ? 'question-active' : ''}}"
    >
      <!-- é¢˜ç›®æ ‡é¢˜ -->
      <view class="question-header">
        <text class="question-num">{{index + 1}}.</text>
        <text class="question-text">{{item.content}}</text>
      </view>

      <!-- é€‰é¡¹ -->
      <view class="options-list">
        <view 
          wx:for="{{item.options}}" 
          wx:for-item="option"
          wx:key="option"
          class="option {{userAnswers[item.id] === option ? 'option-selected' : ''}} {{showAnswer && item.answer === option ? 'option-correct' : ''}} {{showAnswer && userAnswers[item.id] === option && item.answer !== option ? 'option-wrong' : ''}}"
          bindtap="selectAnswer"
          data-question-id="{{item.id}}"
          data-option="{{option}}"
        >
          <view class="option-label">{{option}}</view>
          <view wx:if="{{showAnswer && item.answer === option}}" class="option-icon">âœ“</view>
          <view wx:elif="{{showAnswer && userAnswers[item.id] === option && item.answer !== option}}" class="option-icon">âœ—</view>
        </view>
      </view>

      <!-- ç­”æ¡ˆè§£æ -->
      <view wx:if="{{showAnswer}}" class="explanation">
        <view class="explanation-header">
          <text class="explanation-title">ğŸ’¡ ç­”æ¡ˆè§£æ</text>
        </view>
        <text class="explanation-text">{{item.explanation}}</text>
        
        <!-- å…³é”®è¯æç¤º -->
        <view wx:if="{{item.keywords && item.keywords.length > 0}}" class="keywords">
          <text class="keywords-label">ğŸ”‘ å…³é”®è¯ï¼š</text>
          <text 
            wx:for="{{item.keywords}}" 
            wx:for-item="keyword"
            wx:key="keyword"
            class="keyword-tag"
            bindtap="locateKeyword"
            data-keyword="{{keyword}}"
          >
            {{keyword}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="reading-actions">
    <button class="btn btn-secondary" bindtap="toggleAnswer">
      {{showAnswer ? 'éšè—ç­”æ¡ˆ' : 'æŸ¥çœ‹ç­”æ¡ˆ'}}
    </button>
    <button class="btn btn-primary" bindtap="nextPassage">
      ä¸‹ä¸€ç¯‡ â†’
    </button>
  </view>
  
  <!-- å•è¯å¼¹çª—ç»„ä»¶ -->
  <word-popup
    show="{{showWordPopup}}"
    word="{{selectedWord}}"
    context="{{selectedContext}}"
    bind:close="onCloseWordPopup"
    bind:addtovocab="onWordAddToVocab"
    bind:addtoweakness="onWordAddToWeakness"
  />
  
  <!-- å¥å­åˆ†æå¡ç‰‡ç»„ä»¶ -->
  <sentence-card
    show="{{showSentenceCard}}"
    sentence="{{selectedSentence}}"
    bind:close="onCloseSentenceCard"
    bind:addtopractice="onSentenceAddToPractice"
    bind:variationchange="onVariationChange"
  />

  <!-- é˜…è¯»AIæç¤ºï¼ˆæ–°å¢ï¼‰ -->
  <include src="./reading-ai-hint.wxml" />

</view>

