<!--components/cloze-question/cloze-question.wxml-->
<view class="cloze-question">

  <!-- æ–‡ç« åŒºåŸŸ -->
  <view class="cloze-passage">
    <view class="passage-header">
      <text class="passage-title">å®Œå½¢å¡«ç©º</text>
      <text class="passage-progress">{{answeredCount}}/{{totalBlanks}} å·²å¡«</text>
    </view>

    <scroll-view scroll-y class="passage-content">
      <view class="passage-text">
        <text 
          wx:for="{{contentParts}}" 
          wx:key="index"
          class="{{item.type === 'text' ? 'text-part' : 'blank-part ' + (item.id === currentBlankId ? 'blank-active' : '') + (userAnswers[item.id] ? ' blank-filled' : '')}}"
          bindtap="{{item.type === 'blank' ? 'selectBlank' : ''}}"
          data-id="{{item.id}}"
        >
          {{item.type === 'text' ? item.content : (userAnswers[item.id] || '___' + item.id + '___')}}
        </text>
      </view>
    </scroll-view>
  </view>

  <!-- å½“å‰é¢˜ç›® -->
  <view wx:if="{{currentBlank}}" class="current-question">
    <view class="question-header">
      <text class="blank-num">ç¬¬ {{currentBlank.id}} ç©º</text>
      <text class="context-hint" bindtap="showContext">æŸ¥çœ‹ä¸Šä¸‹æ–‡ â†’</text>
    </view>

    <!-- ä¸Šä¸‹æ–‡æç¤º -->
    <view wx:if="{{showContextHint}}" class="context-box">
      <text class="context-text">{{currentBlank.context}}</text>
    </view>

    <!-- é€‰é¡¹ -->
    <view class="options-grid">
      <view 
        wx:for="{{currentBlank.options}}" 
        wx:for-item="option"
        wx:key="option"
        class="option-card {{userAnswers[currentBlank.id] === option ? 'option-selected' : ''}} {{showAnswer && currentBlank.answer === option ? 'option-correct' : ''}} {{showAnswer && userAnswers[currentBlank.id] === option && currentBlank.answer !== option ? 'option-wrong' : ''}}"
        bindtap="selectOption"
        data-option="{{option}}"
      >
        <text class="option-text">{{option}}</text>
        <view wx:if="{{showAnswer && currentBlank.answer === option}}" class="check-icon">âœ“</view>
      </view>
    </view>

    <!-- è¯ä¹‰è¾¨æ -->
    <view wx:if="{{showAnswer && currentBlank.analysis}}" class="analysis-box">
      <text class="analysis-title">ğŸ“ è¯ä¹‰è¾¨æ</text>
      <text class="analysis-text">{{currentBlank.analysis}}</text>
    </view>
  </view>

  <!-- åº•éƒ¨å¯¼èˆª -->
  <view class="cloze-actions">
    <button 
      class="btn btn-prev" 
      bindtap="prevBlank"
      disabled="{{currentBlankIndex === 0}}"
    >
      â† ä¸Šä¸€ç©º
    </button>
    
    <button 
      class="btn btn-answer" 
      bindtap="toggleAnswer"
    >
      {{showAnswer ? 'éšè—ç­”æ¡ˆ' : 'æŸ¥çœ‹ç­”æ¡ˆ'}}
    </button>
    
    <button 
      class="btn btn-next" 
      bindtap="nextBlank"
      disabled="{{currentBlankIndex === totalBlanks - 1}}"
    >
      ä¸‹ä¸€ç©º â†’
    </button>
  </view>

  <!-- å®Œå‹å¡«ç©ºAIå·¥å…·æ ï¼ˆæ–°å¢ï¼‰ -->
  <include src="./cloze-ai-toolbar.wxml" />

</view>

