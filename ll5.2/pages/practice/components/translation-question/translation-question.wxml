<!--components/translation-question/translation-question.wxml-->
<view class="translation-container">
  
  <!-- ç¿»è¯‘ç±»å‹æ ‡ç­¾ -->
  <view class="translation-type">
    <text class="type-badge {{translationData.type === 'en-zh' ? 'en-zh' : 'zh-en'}}">
      {{translationData.type === 'en-zh' ? 'è‹±è¯‘æ±‰' : 'æ±‰è¯‘è‹±'}}
    </text>
    <text class="difficulty">{{translationData.difficulty}}</text>
  </view>

  <!-- åŸæ–‡ -->
  <view class="source-section">
    <view class="section-header">
      <text class="section-title">åŸæ–‡</text>
    </view>
    <view class="source-content">
      <text class="source-text">{{translationData.sourceText}}</text>
    </view>
  </view>

  <!-- ç”¨æˆ·è¾“å…¥åŒº -->
  <view class="input-section">
    <view class="section-header">
      <text class="section-title">ä½ çš„ç¿»è¯‘</text>
      <text class="word-count">{{wordCount}} è¯</text>
    </view>
    <textarea
      class="translation-input"
      placeholder="è¯·åœ¨æ­¤è¾“å…¥ç¿»è¯‘..."
      value="{{currentAnswer}}"
      bindinput="onInput"
      maxlength="-1"
      auto-height
      disabled="{{showReference}}"
    />
  </view>

  <!-- æäº¤æŒ‰é’® -->
  <view wx:if="{{!showReference}}" class="action-section">
    <button class="btn-submit" bindtap="submitAnswer">
      <text>æäº¤ç­”æ¡ˆ</text>
    </button>
  </view>

  <!-- å‚è€ƒç­”æ¡ˆå’Œå¯¹æ¯” -->
  <view wx:if="{{showReference}}" class="result-section">
    
    <!-- ç›¸ä¼¼åº¦å¾½ç«  -->
    <view class="similarity-badge">
      <text class="similarity-label">ç›¸ä¼¼åº¦:</text>
      <text class="similarity-value {{similarity >= 80 ? 'high' : similarity >= 60 ? 'medium' : 'low'}}">{{similarity}}%</text>
    </view>

    <!-- å‚è€ƒç­”æ¡ˆ -->
    <view class="reference-section">
      <view class="section-header">
        <text class="section-title">å‚è€ƒç­”æ¡ˆ</text>
      </view>
      <view class="reference-content">
        <text class="reference-text">{{translationData.referenceAnswer}}</text>
      </view>
    </view>

    <!-- å·®å¼‚é«˜äº®æ˜¾ç¤º -->
    <view wx:if="{{differences.length > 0}}" class="differences-section">
      <view class="section-header">
        <text class="section-title">ğŸ” å·®å¼‚é«˜äº®å¯¹æ¯”</text>
      </view>
      <view class="differences-content">
        <view class="diff-highlight-container">
          <block wx:for="{{differences}}" wx:key="index">
            <text wx:if="{{item.type === 'equal'}}" class="diff-segment equal">{{item.text}}</text>
            <text wx:elif="{{item.type === 'removed'}}" class="diff-segment removed">{{item.text}}</text>
            <text wx:elif="{{item.type === 'added'}}" class="diff-segment added">{{item.text}}</text>
          </block>
        </view>
        
        <view class="diff-legend">
          <view class="legend-item">
            <view class="legend-color equal"></view>
            <text>æ­£ç¡®</text>
          </view>
          <view class="legend-item">
            <view class="legend-color removed"></view>
            <text>ç¼ºå°‘</text>
          </view>
          <view class="legend-item">
            <view class="legend-color added"></view>
            <text>å¤šä½™/é”™è¯¯</text>
          </view>
        </view>
      </view>
    </view>

    <!-- AIè¯„åˆ†ç»“æœ -->
    <view wx:if="{{aiEvaluation}}" class="ai-evaluation-section">
      <view class="section-header ai-header">
        <text class="section-title">ğŸ¤– AIä¸“ä¸šè¯„åˆ†</text>
      </view>
      
      <view class="score-display">
        <text class="score-label">ç»¼åˆå¾—åˆ†</text>
        <text class="score-value">{{aiEvaluation.score}}</text>
        <text class="score-max">/100</text>
      </view>

      <view class="evaluation-details">
        <view class="detail-item">
          <text class="detail-label">å‡†ç¡®æ€§</text>
          <text class="detail-score">{{aiEvaluation.accuracy}}/30</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æµç•…æ€§</text>
          <text class="detail-score">{{aiEvaluation.fluency}}/30</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å®Œæ•´æ€§</text>
          <text class="detail-score">{{aiEvaluation.completeness}}/20</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">è¡¨è¾¾åŠ›</text>
          <text class="detail-score">{{aiEvaluation.expression}}/20</text>
        </view>
      </view>

      <view class="ai-feedback">
        <text class="feedback-title">ğŸ’¬ AIç‚¹è¯„</text>
        <text class="feedback-content">{{aiEvaluation.feedback}}</text>
      </view>

      <view wx:if="{{aiEvaluation.suggestions}}" class="ai-suggestions">
        <text class="suggestions-title">ğŸ’¡ æ”¹è¿›å»ºè®®</text>
        <text class="suggestions-content">{{aiEvaluation.suggestions}}</text>
      </view>
    </view>

    <!-- AIè¯„åˆ†åŠ è½½ä¸­ -->
    <view wx:if="{{isEvaluating}}" class="ai-loading">
      <text class="loading-icon">â³</text>
      <text class="loading-text">AIè¯„åˆ†ä¸­ï¼Œè¯·ç¨å€™...</text>
    </view>

    <!-- è§£æï¼ˆå¦‚æœæœ‰ï¼‰ -->
    <view wx:if="{{translationData.explanation}}" class="explanation-section">
      <view class="section-header">
        <text class="section-title">ç¿»è¯‘è¦ç‚¹</text>
      </view>
      <view class="explanation-content">
        <text class="explanation-text">{{translationData.explanation}}</text>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-section">
      <button class="btn-secondary" bindtap="retranslate">
        <text>é‡æ–°ç¿»è¯‘</text>
      </button>
    </view>
  </view>

  <!-- ç¿»è¯‘AIä¾§è¾¹æ ï¼ˆæ–°å¢ï¼‰ -->
  <include src="./translation-ai-sidebar.wxml" />

</view>

