<!--pages/ai-assistant/ai-assistant.wxml-->
<view class="ai-page {{themeClass}}">
  
  <!-- Tabåˆ‡æ¢ï¼ˆå·²éšè—ç²¾è®²è¯¾ç¨‹ï¼‰ -->
  <view class="ai-tabs" style="display: none;">
    <view 
      class="tab-item {{activeTab === 'chat' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="chat"
    >
      <text>AIå¯¹è¯</text>
    </view>
    <!-- ç²¾è®²è¯¾ç¨‹ Tab å·²éšè— -->
    <!--     <view 
      wx:if="{{false}}"
      class="tab-item {{activeTab === 'courses' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="courses"
    >
      <text>ç²¾è®²è¯¾ç¨‹</text>
    </view> -->
  </view>

  <!-- AIå¯¹è¯Tab -->
  <view wx:if="{{activeTab === 'chat'}}" class="chat-tab">
    
    <!-- éª¨æ¶å±ï¼ˆæ•°æ®åŠ è½½æœŸé—´æ˜¾ç¤ºï¼‰ -->
    <skeleton 
      wx:if="{{isLoading}}" 
      type="ai-assistant"
    />
    
    <!-- æ¬¢è¿è¯­ï¼ˆé¦–æ¬¡è¿›å…¥æ˜¾ç¤ºï¼‰ -->
    <view wx:if="{{messages.length === 0 && !isLoading}}" class="welcome-section">
      <!-- â­ ç§»é™¤é¡¶éƒ¨å›¾æ ‡ -->
      <text class="welcome-title"> ä½ å¥½ï¼æˆ‘æ˜¯AIå­¦ä¹ ä¼™ä¼´</text>
      <text class="welcome-subtitle">æˆ‘å¯ä»¥å¸®ä½ è§£ç­”é—®é¢˜ã€åˆ†æå­¦ä¹ æ•°æ®ã€åˆ¶å®šå­¦ä¹ è®¡åˆ’</text>
      
      <view class="welcome-suggestions">
        <text class="suggestions-title">è¯•è¯•é—®æˆ‘ï¼š</text>
        <view 
          wx:for="{{quickSuggestions}}" 
          wx:key="*this"
          class="suggestion-btn"
          bindtap="sendQuickQuestion"
          data-question="{{item}}"
        >
          <text>{{item}}</text>
        </view>
      </view>
    </view>

    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <scroll-view 
      wx:else
      scroll-y 
      class="chat-messages"
      scroll-into-view="{{scrollToView}}"
      scroll-with-animation
    >
      <view 
        wx:for="{{messages}}" 
        wx:key="id"
        id="msg-{{item.id}}"
        class="message-wrapper {{item.role === 'user' ? 'user-message' : 'ai-message'}}"
      >
        <view class="message-container">
          <view class="message-avatar-placeholder">{{item.role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}}</view>
          <view class="message-bubble">
            <text class="message-text">{{item.content}}</text>
            
            <!-- AIæ¶ˆæ¯çš„æ“ä½œå¡ç‰‡ï¼ˆå¯é€‰ï¼‰ -->
            <view wx:if="{{item.actionCard}}" class="action-card">
              <text class="action-title">{{item.actionCard.title}}</text>
              <text class="action-desc">{{item.actionCard.description}}</text>
              <button 
                class="action-btn"
                bindtap="handleActionCard"
                data-action="{{item.actionCard.action}}"
                data-params="{{item.actionCard.params}}"
              >
                {{item.actionCard.buttonText}}
              </button>
            </view>
            
            <!-- AI Native: åé¦ˆæŒ‰é’®ï¼ˆP1-002é›†æˆï¼‰ -->
            <feedback-button
              wx:if="{{item.role === 'ai' && item.id}}"
              content-id="{{item.id}}"
              content-type="conversation"
              context="{{item.feedbackContext}}"
              bind:feedbackSubmit="onFeedbackSubmit"
            />
          </view>
        </view>
        <text class="message-time">{{item.time}}</text>
      </view>
      
      <!-- AIæ‰“å­—ä¸­åŠ¨ç”» -->
      <view wx:if="{{aiTyping}}" class="message-wrapper ai-message">
        <view class="message-container">
          <view class="message-avatar-placeholder">ğŸ¤–</view>
          <view class="message-bubble typing-bubble">
            <view class="typing-indicator">
              <view class="typing-dot"></view>
              <view class="typing-dot"></view>
              <view class="typing-dot"></view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- å¿«æ·åŠŸèƒ½æŒ‰é’® - ç®€åŒ–ç‰ˆï¼ˆä»…æ–‡å­—ï¼‰ -->
    <view class="quick-actions">
      <scroll-view scroll-x class="actions-scroll" show-scrollbar="{{false}}">
        <view class="actions-list">
          <view 
            wx:for="{{quickActions}}" 
            wx:key="id"
            class="action-item-simple"
            bindtap="sendQuickAction"
            data-action="{{item.action}}"
          >
            <text class="action-label-simple">{{item.label}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- è¾“å…¥æ  - ç®€åŒ–ç‰ˆï¼ˆç§»é™¤æ¸…é™¤å›¾æ ‡ï¼‰ -->
    <view class="input-bar">
      <view class="input-wrapper">
        <input 
          class="message-input"
          placeholder="è¾“å…¥æ¶ˆæ¯..."
          value="{{inputText}}"
          bindinput="onInput"
          bindconfirm="sendMessage"
          confirm-type="send"
          adjust-position="{{true}}"
        />
      </view>
      <button 
        class="send-btn {{inputText ? 'active' : ''}}"
        bindtap="sendMessage"
        disabled="{{!inputText}}"
      >
        å‘é€
      </button>
    </view>
  </view>

  <!-- ç²¾è®²è¯¾ç¨‹Tab - æš‚æ—¶éšè— -->
  <view wx:if="{{false && activeTab === 'courses'}}" class="courses-tab">
    <scroll-view scroll-y class="courses-scroll">
      
      <!-- è¯¾ç¨‹åˆ†ç±» -->
      <view class="course-categories">
        <scroll-view scroll-x class="categories-scroll">
          <view class="categories-list">
            <view 
              wx:for="{{courseCategories}}" 
              wx:key="id"
              class="category-btn {{selectedCategory === item.id ? 'active' : ''}}"
              bindtap="selectCategory"
              data-id="{{item.id}}"
            >
              <text>{{item.name}}</text>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- è¯¾ç¨‹åˆ—è¡¨ -->
      <view class="courses-list">
        <view 
          wx:for="{{filteredCourses}}" 
          wx:key="id"
          class="course-card"
          bindtap="goToCourseDetail"
          data-id="{{item.id}}"
        >
          <view class="course-cover">
            <image src="{{item.cover || '/images/placeholder.png'}}" mode="aspectFill"></image>
            <view wx:if="{{item.progress > 0}}" class="course-progress-overlay">
              <text class="progress-text">å·²å­¦{{item.progress}}%</text>
            </view>
          </view>
          
          <view class="course-info">
            <text class="course-title">{{item.title}}</text>
            <text class="course-instructor">{{item.instructor}}</text>
            
            <view class="course-meta">
              <view class="meta-item">
                <text class="rating">{{item.rating}} â­</text>
              </view>
              <text class="meta-divider">Â·</text>
              <view class="meta-item">
                <text>{{item.students}}äººå­¦ä¹ </text>
              </view>
            </view>
            
            <view class="course-tags">
              <view class="tag">{{item.difficulty}}</view>
              <view class="tag">{{item.lessons}}è¯¾æ—¶</view>
              <view class="tag">{{item.duration}}</view>
            </view>
            
            <button 
              class="course-btn {{item.progress > 0 ? 'btn-continue' : 'btn-start'}}"
              bindtap="startCourse"
              catchtap=""
              data-id="{{item.id}}"
            >
              {{item.progress > 0 ? 'ç»§ç»­å­¦ä¹ ' : 'å¼€å§‹å­¦ä¹ '}}
            </button>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view wx:if="{{filteredCourses.length === 0}}" class="empty-state">
          <view class="empty-icon-placeholder">ğŸ“š</view>
          <text class="empty-text">è¯¥åˆ†ç±»æš‚æ— è¯¾ç¨‹</text>
        </view>
      </view>
      
    </scroll-view>
  </view>

</view>

