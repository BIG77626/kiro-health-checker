<!--pages/vocabulary/vocabulary.wxml - æ™ºèƒ½å­¦ä¹ æµç¨‹-->
<view class="vocab-page {{themeClass}}">
  
  <!-- å¿«é€Ÿè®¾ç½®ç»„ä»¶ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰ -->
  <quick-setup 
    show="{{showQuickSetup}}"
    bind:confirm="onSetupConfirm"
    bind:skip="onSetupSkip"
  />

  <!-- å­¦ä¹ é¡µé¢ -->
  <view wx:if="{{pageState === 'learning'}}" class="learning-container">
    
    <!-- é¡¶éƒ¨è¿›åº¦æ¡ -->
    <view class="learning-header">
      <view class="progress-section">
        <view class="progress-info">
          <text class="progress-text">ä»Šæ—¥è¿›åº¦ {{learnedCount}}/{{dailyGoal}}</text>
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{progress}}%"></view>
          </view>
        </view>
        <text class="progress-percent">{{progress}}%</text>
      </view>
      <button class="btn-pause" bindtap="pauseLearning">æš‚åœ</button>
    </view>

    <!-- å•è¯å¡ç‰‡ -->
    <view class="word-card-container">
      <view class="word-card">
        <text class="word-en">{{currentWord.word}}</text>
        <text class="word-phonetic">{{currentWord.phonetic}}</text>
        <view class="word-divider"></view>
        <text class="word-cn">{{currentWord.meaning}}</text>
        <view class="word-example">
          <text class="example-label">ä¾‹å¥</text>
          <text class="example-en">{{currentWord.example}}</text>
          <text class="example-cn">{{currentWord.exampleCN}}</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="word-actions">
      <button class="btn-action btn-hard" bindtap="markWord" data-mastery="hard">
        <text class="btn-text">ä¸è®¤è¯†</text>
        <text class="btn-hint">1å¤©åå¤ä¹ </text>
      </button>
      <button class="btn-action btn-easy" bindtap="markWord" data-mastery="easy">
        <text class="btn-text">è®¤è¯†</text>
        <text class="btn-hint">7å¤©åå¤ä¹ </text>
      </button>
    </view>

  </view>

  <!-- å®Œæˆé¡µé¢ -->
  <view wx:if="{{pageState === 'completed'}}" class="completion-container">
    
    <!-- å®ŒæˆåŠ¨ç”» -->
    <image src="/images/celebration.png" class="celebration-icon" mode="aspectFit"/>
    
    <text class="completion-title">å¤ªæ£’äº†ï¼</text>
    <text class="completion-subtitle">ä»Šæ—¥å­¦ä¹ ç›®æ ‡å·²å®Œæˆ</text>

    <!-- å­¦ä¹ ç»Ÿè®¡ -->
    <view class="completion-stats">
      <view class="stat-item">
        <text class="stat-num">{{sessionStats.learnedCount}}</text>
        <text class="stat-label">å­¦ä¹ å•è¯</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{sessionStats.timeSpent}}</text>
        <text class="stat-label">å­¦ä¹ æ—¶é•¿(åˆ†)</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{sessionStats.accuracy}}%</text>
        <text class="stat-label">æŒæ¡ç‡</text>
      </view>
    </view>

    <!-- æ™ºèƒ½å»ºè®® -->
    <view wx:if="{{showTestSuggestion}}" class="smart-suggestion">
      <text class="suggestion-icon">ğŸ’¡</text>
      <view class="suggestion-content">
        <text class="suggestion-title">å»ºè®®è¿›è¡Œæµ‹è¯•å·©å›º</text>
        <text class="suggestion-desc">{{testSuggestionMessage}}</text>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="completion-actions">
      <button wx:if="{{showTestSuggestion}}" class="btn-primary" bindtap="startTest">
        ç«‹å³æµ‹è¯•
      </button>
      <button class="btn-secondary" bindtap="backToHome">
        è¿”å›é¦–é¡µ
      </button>
    </view>

  </view>

  <!-- å·²å®Œæˆæç¤ºé¡µé¢ï¼ˆä»Šæ—¥ç›®æ ‡å·²è¾¾æˆï¼‰ -->
  <view wx:if="{{pageState === 'already_completed'}}" class="already-completed-container">
    
    <image src="/images/trophy.png" class="trophy-icon" mode="aspectFit"/>
    
    <text class="achievement-title">ä»Šæ—¥ç›®æ ‡å·²å®Œæˆ</text>
    <text class="achievement-subtitle">è¿ç»­å­¦ä¹  {{streak}} å¤©</text>

    <view class="today-stats">
      <view class="stat-row">
        <text class="stat-label">ä»Šæ—¥å­¦ä¹ </text>
        <text class="stat-value">{{todayLearned}} ä¸ªå•è¯</text>
      </view>
      <view class="stat-row">
        <text class="stat-label">ç´¯è®¡å­¦ä¹ </text>
        <text class="stat-value">{{totalLearned}} ä¸ªå•è¯</text>
      </view>
      <view class="stat-row">
        <text class="stat-label">å¹³å‡æŒæ¡ç‡</text>
        <text class="stat-value">{{accuracy}}%</text>
      </view>
    </view>

    <view class="achievement-actions">
      <button wx:if="{{showTestSuggestion}}" class="btn-primary" bindtap="startTest">
        è¿›è¡Œæµ‹è¯•
      </button>
      <button class="btn-secondary" bindtap="backToHome">
        è¿”å›é¦–é¡µ
      </button>
    </view>

  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{pageState === 'loading'}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- AIåŠ©æ‰‹æç¤ºï¼ˆå…¨å±€ï¼‰ -->
  <view wx:if="{{showAIHint}}" class="ai-hint-modal">
    <view class="ai-hint-overlay" catchtap="onDismissHint"></view>
    <view class="ai-hint-content">
      <text class="ai-hint-title">AIåŠ©æ‰‹</text>
      <text class="ai-hint-message">{{aiHintMessage}}</text>
      <view class="ai-hint-actions">
        <button class="ai-btn-secondary" bindtap="onDismissHint">æˆ‘çŸ¥é“äº†</button>
        <button wx:if="{{aiHintAction}}" class="ai-btn-primary" bindtap="onAcceptHint">
          {{aiHintAction}}
        </button>
      </view>
    </view>
  </view>

  <!-- ç”Ÿè¯æœ¬æç¤ºå¼¹çª—ï¼ˆå…¨å±€ï¼‰ -->
  <vocab-book-prompt
    visible="{{showVocabBookPrompt}}"
    wordData="{{vocabBookWordData}}"
    attempts="{{vocabBookAttempts}}"
    hardCount="{{vocabBookHardCount}}"
    bind:addToVocabBook="onAddToVocabBook"
    bind:skipVocabBook="onSkipVocabBook"
  />

  <!-- æœ€å°åŒ–ç”Ÿè¯æœ¬æç¤ºï¼ˆå³ä¸‹è§’ï¼‰ -->
  <view wx:if="{{showMiniVocabToast}}" class="mini-vocab-toast">
    <view class="toast-content">
      <text class="toast-icon">ğŸ“–</text>
      <text class="toast-text">å·²åŠ åˆ°ç”Ÿè¯æœ¬</text>
    </view>
  </view>

</view>
