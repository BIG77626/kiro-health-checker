# Vocabulary 页面集成测试计划

> **目标**: 验证新旧架构并行运行的正确性和一致性  
> **阶段**: Phase 3.1 - Step 3.1/3.2 完成后执行  
> **时间**: 2025-11-07

---

## 📋 测试清单

### ✅ Step 3.1: 引入 ViewModel（已完成）

- [x] 在 `onLoad()` 中初始化 ViewModel
- [x] 添加功能开关 `USE_NEW_ARCHITECTURE`（默认 false）
- [x] 保留所有旧代码，确保不影响现有功能
- [x] 添加新架构方法：`startNewLearningNew()`, `markWordNew()`

### ⏳ Step 3.2: 并行运行新旧逻辑（待测试）

#### 手动测试步骤

1. **测试旧逻辑运行正常**
   ```javascript
   // USE_NEW_ARCHITECTURE = false（默认）
   ```
   - [ ] 页面能正常加载
   - [ ] 能看到学习的单词列表
   - [ ] 点击"认识/不认识"能正常标记
   - [ ] 完成学习后显示统计页面
   - [ ] 无控制台错误

2. **测试新架构初始化**
   - [ ] 查看控制台日志：`✅ [词汇学习] ViewModel 初始化成功`
   - [ ] 确认没有初始化错误

3. **切换到新架构测试**
   ```javascript
   // 修改 USE_NEW_ARCHITECTURE = true
   ```
   - [ ] 页面能正常加载
   - [ ] 能看到学习的单词列表（基于间隔重复算法）
   - [ ] 点击"认识/不认识"能正常标记
   - [ ] 查看控制台日志确认答案已记录
   - [ ] 完成学习后显示统计页面
   - [ ] 无控制台错误

4. **数据一致性验证**
   - [ ] 对比新旧架构返回的单词列表
   - [ ] 验证SM-2算法计算的下次复习时间
   - [ ] 确认本地存储中的数据格式正确

---

## 🔍 关键验证点

### 1. ViewModel 初始化
- ✅ 容器创建成功
- ✅ 依赖注入正确
- ✅ ViewModel 实例可用

### 2. 学习会话启动
- [ ] `startSession()` 返回正确数据格式
- [ ] 单词列表包含 SM-2 状态字段
- [ ] 今日复习计划正确生成

### 3. 答题记录
- [ ] `recordAnswer()` 正确保存状态
- [ ] 间隔重复算法正常计算
- [ ] 下次复习日期正确更新

### 4. 错误处理
- [ ] ViewModel 初始化失败时回退到旧逻辑
- [ ] 网络错误时显示友好提示
- [ ] 数据错误时不影响页面使用

---

## 📊 性能对比

### 旧架构性能（基准）
- 页面加载时间: ~20秒（从性能基准测试）
- 网络请求: 多次云数据库查询
- 用户体验: 明显卡顿

### 新架构性能（预期）
- 页面加载时间: < 500ms
- 网络请求: 0次（完全本地化）
- 用户体验: 流畅无卡顿

### 测试方法
```javascript
// 在 onReady() 中已有性能跟踪
const loadTime = Date.now() - this.__loadStartTime
console.log('⏱️ 页面加载时间:', loadTime, 'ms')
```

---

## 🚨 回滚策略

如果测试发现问题：

1. **立即回滚**
   ```bash
   # 恢复备份文件
   copy pages\vocabulary\vocabulary.js.phase2.backup pages\vocabulary\vocabulary.js
   ```

2. **问题排查**
   - 查看控制台错误日志
   - 检查 ViewModel 测试是否全部通过
   - 验证 DI 容器配置是否正确

3. **修复后重新测试**
   - 修复代码
   - 运行单元测试
   - 重新执行手动测试

---

## ✅ 验收标准

### 功能完整性
- [ ] 旧架构功能完全正常（USE_NEW_ARCHITECTURE = false）
- [ ] 新架构功能完全正常（USE_NEW_ARCHITECTURE = true）
- [ ] 两种模式可随时切换
- [ ] 无控制台错误

### 性能指标
- [ ] 新架构加载时间 < 500ms
- [ ] 性能提升 > 95%
- [ ] 无明显卡顿
- [ ] 内存使用正常

### 数据正确性
- [ ] 间隔重复算法正确执行
- [ ] 词汇状态正确更新
- [ ] 下次复习日期正确计算
- [ ] 本地存储数据完整

---

## 📝 测试记录

### 测试环境
- 微信开发者工具版本: 
- 小程序基础库版本: 
- 测试时间: 
- 测试人员: 

### 测试结果

#### 旧架构测试
- 功能测试: ⏳ 待测试
- 性能测试: ⏳ 待测试
- 问题记录: 

#### 新架构测试
- 功能测试: ⏳ 待测试
- 性能测试: ⏳ 待测试
- 问题记录: 

#### 对比测试
- 数据一致性: ⏳ 待测试
- 性能对比: ⏳ 待测试
- 用户体验: ⏳ 待测试

---

## 🔗 相关文档

- [Phase 3.1 任务清单](./PHASE3.1_TASK_CHECKLIST.md)
- [Phase 3 执行计划](../../PHASE3_EXECUTION_PLAN.md)
- [VocabularyViewModel 测试](../../pages/vocabulary/__tests__/VocabularyViewModel.test.js)
- [learningContainer 测试](../../core/infrastructure/di/__tests__/learningContainer.test.js)

---

**测试原则**: 完整测试 → 发现问题 → 立即修复 → 重新验证 🔄
